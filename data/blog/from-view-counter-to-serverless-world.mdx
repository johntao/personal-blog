---  
title: 'å¾æ–‡ç« é»æ“Šæ¬¡æ•¸åŠŸèƒ½ï¼Œé€²åˆ°ç„¡ä¼ºæœå™¨é‹ç®—æ–°ä¸–ç•Œ'
date: '2022-08-20'
lastmod: '2022-08-20'
tags: ['build-a-blog', 'blog-functions', 'jamstack', 'serverless', 'tech-skills-basic']
draft: false
summary: 'å®Œæ•´ä»‹ç´¹å¦‚ä½•åœ¨ Next.Js ä½¿ç”¨ serverless è³‡æ–™åº«ï¼Œå¯¦ä½œæ–‡ç« ç€è¦½äººæ¬¡åŠŸèƒ½'
images: []
---

## é©åˆé–±è®€å°è±¡

- å…·å‚™åŸºç¤ç¨‹å¼èƒ½åŠ›
- å° serverless æ„Ÿèˆˆè¶£
- é–±è®€éå‰ç¯‡ [Jamstack ä»‹ç´¹](https://www.johntao.one/blog/build-a-blog-using-next-js)ï¼Œæƒ³ç¹¼çºŒæ‰“ç£¨æ“´å…… next.js åŠŸèƒ½

## å‰è¨€

ä¸€åˆ‡éƒ½è¦å¾é€™å¼µåœ–èªªèµ·

<ImageWithCap
   alt="Reading time, view counter"
   src="/static/images/2022/readingtime-viewcounter.png"
   cap="Image from [Parth Desai](https://musing.vercel.app/blog/WWDC22)"
   />

åœ–ä¸­é»ƒè‰²åº•ç·šæ¨™ç¤ºå€åŸŸï¼Œåˆ†åˆ¥æœ‰æ–‡ç« å­—æ•¸ã€é–±è®€æ™‚é–“èˆ‡ç€è¦½äººæ¬¡ï¼Œçœ‹èµ·ä¾†å°±å¾ˆå²å®³

æœ¬ä¾†ä»¥ç‚ºé€™åŠŸèƒ½å¾ˆå¥½å¯¦ä½œï¼Œæ–°æ‰‹åŒ…æ‡‰è©²é™„æœ‰æ¥å£ï¼Œæˆ‘å€‘åªéœ€è¦æ¥é€šæˆ–æ‰“é–‹åŠŸèƒ½

å¯¦éš›ä¸Šå°ä¸€åŠï¼Œé–±è®€æ™‚é–“èˆ‡å­—æ•¸ç¢ºå¯¦æ˜¯æ—¢æœ‰åŠŸèƒ½ï¼Œåªæ˜¯æ²’ä¸²æ¥åˆ°å‰ç«¯é¡¯ç¤ºï¼Œä½†ç€è¦½äººæ¬¡å°±ä¸æ˜¯é€™éº¼ä¸€å›äº‹äº†  
ï¼ˆæœ¬ç¯‡æ–‡ç« æš«ä¸è¨è«–å¦‚ä½•æ¥é€šé–±è®€æ™‚é–“èˆ‡å­—æ•¸ï¼‰

é‚„è¨˜å¾—ä¸Šç¯‡æ–‡ç« [ä»‹ç´¹ Jamstack](https://www.johntao.one/blog/build-a-blog-using-next-js#jamstack-%E5%B9%BE%E5%80%8B%E5%B8%B8%E8%A6%8B%E7%9A%84%E5%85%83%E4%BB%B6) æ™‚ï¼Œæœ‰æåˆ° JAM çš„ A (API) ä¸æ˜¯å¿…è¦å…ƒç´ å—ï¼Ÿ

ç€è¦½äººæ¬¡åœ¨é€™é‚Šå°±éœ€è¦å¯¦ä½œå®Œæ•´çš„ APIï¼Œæ‹†è§£å¾Œå¤§è‡´ä¸Šæœƒæœ‰é€™äº›å·¥ä½œé …ç›®

- å»ºç«‹ä¸€å€‹ db (æ²’éŒ¯ï¼Œå°±æ˜¯ä¸€å€‹æ‰å¯¦çš„ database)
   - å»ºç«‹è³‡æ–™è¡¨ï¼Œæ¬„ä½åˆ†åˆ¥æ˜¯ "æ–‡ç« url" èˆ‡ "ç€è¦½äººæ¬¡"
- ä½¿ç”¨èƒ½æ‰“åˆ° db çš„ ORM framework
   - å»ºç«‹ ORM æ‰€éœ€ schema
- å»ºç«‹ CRUD API (é€™è£¡å°±æ˜¯ JAM çš„ A)
   - åŸ·è¡Œ ORM æ–¹æ³•å° db é€²è¡Œ CRUD æ“ä½œ
- å»ºç«‹ ViewCounter å…ƒä»¶
   - é€é hooks å»æ‰“å‰›å‰›å®£å‘Šçš„ API
- å°‡ ViewCounter å…ƒä»¶åŠ é€²ç›¸é—œ Layout

ä»¥ä¸‹æŒ‰ç…§é€™äº›æ­¥é©Ÿé€²è¡Œè¬›è§£

## å»ºç«‹è³‡æ–™åº«

é–‹å§‹ä»‹ç´¹æœ¬ç¯‡æ–‡ç« çš„ä¸»è§’ [PlanetScale](https://planetscale.com/)

PlanetScale æ˜¯ä¸€å¥—åŸºæ–¼ [Vitess](https://vitess.io/) çš„æ–°å‹ DBaaS (Database as Service) æœå‹™

å¯ä»¥åœ¨å¹¾ç§’é˜çš„æ™‚é–“å°±ç”Ÿæˆä¸€å€‹è³‡æ–™åº«ï¼Œä¸¦çœå»ä½¿ç”¨è€…ç…©è…¦é€£ç·šç®¡ç†ç­‰å•é¡Œ

Vitess æŠ€è¡“é©…å‹•äº†è¨±å¤šéœ€è¦é«˜æ“´å±• (Scalability)ã€é«˜æ€§èƒ½ (Performance)ã€é«˜é‹ä½œæ™‚é–“ (Uptime) çš„ hyperscale ç¶²ç«™

æ­¤å¤– PlanetScale é‚„åŠ å…¥äº†åƒ git ä¸€æ¨£çš„åˆ†æ”¯æ¦‚å¿µï¼Œé”åˆ°ç„¡ç¸«ã€ç„¡é˜»å¡ (non-blocking) çš„æ–¹å¼æ›´æ–°è³‡æ–™åº« (database migrations)

åœ¨é–‹å§‹ä¹‹å‰ï¼Œå¯å…ˆå» PlanetScale è¨»å†Šå¸³è™Ÿï¼Œæˆ‘æ˜¯ç›´æ¥ä½¿ç”¨ GitHub è¨»å†Š

è¨»å†Šå¾Œæ¥è‘—è¦ä¸‹è¼‰ [PlanetScale CLI å·¥å…·](https://planetscale.com/features/cli)ï¼Œä»¥ä¾¿æ–¼ local ç«¯é–‹ç™¼æ¸¬è©¦ï¼ŒCLI ä¸»è¦æœ‰ä¸‹åˆ—å¹¾å€‹åŠŸèƒ½

- ç”¨ proxy æ–¹å¼é€£åˆ° PlanetScale db
- å»ºç«‹ db åˆ†æ”¯
- æäº¤ schema éƒ¨ç½²è«‹æ±‚

ä¸‹åœ–ç‚º PlanetScale æ–°è¨»å†Šå¸³è™Ÿçš„ç•«é¢ï¼Œçœ‹å®Œå°è¦½å¾Œé»æ“Šå·¦ä¸‹æ–¹ "Create your first database"

![PlanetScale homepage](https://i.imgur.com/145Q925.gif)

æ¥è‘—å‘½åä½ çš„è³‡æ–™åº«ï¼Œé€™è£¡æˆ‘å–åç‚º `personal-blog`ï¼Œç„¶å¾Œé¸æ“‡é›¢è‡ªå·±åœ‹å®¶æœ€è¿‘çš„ä¼ºæœå™¨ä½ç½®ï¼Œå†é»æ“Š "Create Database" å¦‚ä¸‹åœ–

![PlanetScale create database](/static/images/2022/create-database.png)

é€™æ¨£å°±å®Œæˆè³‡æ–™åº«æ–°å¢äº†ï¼æ¥ä¸‹ä¾†é»é¸ç•«é¢å³ä¸Šè§’ "Connect" ç”¢ç”Ÿ db é€£ç·šå­—ä¸²èˆ‡å¯†ç¢¼ï¼Œå¦‚ä¸‹åœ–

![PlanetScale create database](/static/images/2022/planetscale-dashboard.png)

ç”¢ç”Ÿå¸³è™Ÿå¯†ç¢¼å¾Œè¦è‡ªè¡Œè¨˜ä¸‹ä¾†ï¼Œä¸€æ—¦é›¢é–‹ç•«é¢å¯†ç¢¼å°±å†ä¹Ÿç„¡æ³•é¡¯ç¤ºå‡ºä¾†

å¦‚æœä¸å¹¸è·³éè¦–çª—çš„è©±ä¹Ÿæ²’é—œä¿‚ï¼Œåªè¦é‡æ–°ç”¢ç”Ÿä¸€çµ„æ–°å¯†ç¢¼ï¼Œè¨˜ä¸‹ä¾†ä¹‹å¾Œå†æŠŠèˆŠå¯†ç¢¼åˆªé™¤å°± ok äº†

åœ¨å¸³å¯†ç•«é¢ä¸‹æ–¹ï¼Œé€£æ¥æ–¹æ³•é¸æ“‡ "Prisma" å¦‚ä¸‹åœ–ï¼Œè¨˜ä¸‹ `DATABASE_URL` é€™çµ„è¨­å®šï¼Œä¹‹å¾Œæœƒéœ€è¦åœ¨ Vercel è¨­æˆç’°å¢ƒè®Šæ•¸
(Vercel ç’°å¢ƒè®Šæ•¸å¯åƒè€ƒä¹‹å‰ [giscus æ–‡ç« ä»‹ç´¹#å¥—ç”¨-giscus-api-èˆ‡è¨­å®š-vercel-ç’°å¢ƒè®Šæ•¸](/blog/how-to-setup-giscus#%E5%A5%97%E7%94%A8-giscus-api-%E8%88%87%E8%A8%AD%E5%AE%9A-vercel-%E7%92%B0%E5%A2%83%E8%AE%8A%E6%95%B8))

![PlanetScale your generated password](/static/images/2022/your-generated-password.png)

æ¥è‘—æ‰“é–‹ terminal åŸ·è¡Œ `pscale auth login`ï¼Œæ­¤æ™‚æœƒè‡ªå‹•é–‹å•Ÿç€è¦½å™¨ç¶²é é€²è¡Œé©—è­‰

é€šéèªè­‰å¾ŒåŸ·è¡Œ `pscale branch create personal-blog dev`ï¼Œå°±æœƒå¾é è¨­çš„ `main` æ‹‰å‡ºä¸€æ”¯ `dev` åˆ†æ”¯

é€™æ™‚å†åŸ·è¡Œ `pscale connect personal-blog dev --port 3309`ï¼Œå°±å¯ä»¥é€é `localhost:3309` ç›´æ¥é€£åˆ°é›²ç«¯çš„è³‡æ–™åº«äº†ï½

## è¨­å®š ORM framework (schema migration)

å…ˆåœ¨ terminal ä¾åºå®‰è£ `npm install prisma`ã€`npm install @prisma/client`

æ¥è‘—åŸ·è¡Œ `npx prisma init`ï¼Œé–‹å•Ÿæª”æ¡ˆå°ˆæ¡ˆæ ¹ç›®éŒ„ `.env` æª”æ¡ˆ  
(.env å±¬æ–¼æ•æ„Ÿè³‡è¨Šæª”æ¡ˆï¼Œè¨˜å¾—åŠ å…¥ .gitignore)

èª¿æ•´æˆé€™æ¨£ `DATABASE_URL="mysql://root@127.0.0.1:3309/personal-blog"`

é–‹å•Ÿæª”æ¡ˆ `prisma/schema.prisma`ï¼Œä¿®æ”¹å¦‚ä¸‹

```
generator client {
  provider = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider = "mysql"
  url = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model views {
  slug  String @id @db.VarChar(128)
  count BigInt @default(1)
}
```

åœ¨é€™è£¡æˆ‘å€‘å®£å‘Šäº†ä¸€çµ„ model `views`ï¼Œç”¨æ–¼è¨˜éŒ„æ¯ä¸€ç¯‡æ–‡ç« çš„ç€è¦½äººæ¬¡ (`slug`å³æ–‡ç«  url/ `count`å³ç€è¦½äººæ¬¡)

æ¥è‘—åŸ·è¡Œ `npx prisma db push`ï¼Œå¦‚æ­¤å°±èƒ½å°‡ table schema æ›´æ–°åˆ°å…ˆå‰é€£ç·šçš„ `localhost:3309` db ä¸Š  
(ä¹Ÿå°±æ˜¯ database: personal-blog/ branch: dev)

åˆ° dev åˆ†æ”¯ schema tab æª¢æŸ¥ä¸€ä¸‹ï¼Œç¢ºèªå‰›å‰›å®£å‘Šçš„ model çš„ç¢ºæ›´æ–°ä¸Šå»äº†ï¼Œå¦‚ä¸‹åœ–

![PlanetScale, dev-branch-schema](/static/images/2022/dev-branch-schema.png)

è‹¥ä¸€åˆ‡çœ‹èµ·ä¾†éƒ½é †åˆ©ï¼Œå°±å¯ä»¥åŸ·è¡Œ `pscale deploy-request create personal-blog dev`ï¼Œå°‡ dev åˆ†æ”¯çš„æ”¹å‹•åˆä½µåˆ° main  
(å°±è·Ÿ GitHub pull request ä¸€æ¨£ï¼)

å¦‚æœ deploy-request çœ‹åˆ°é€™æ¨£çš„éŒ¯èª¤è¨Šæ¯ --> `Error: Database branch main is not a production branch.`

è¡¨ç¤º CLI åœ¨æŠ±æ€¨ `main` åˆ†æ”¯æ²’æœ‰è¢«ææ‹”ç‚º production branchï¼Œæ‰€ä»¥ä¸èƒ½é€²è¡Œ `deploy-request`

é€™æ™‚å€™è¦å…ˆå›åˆ° dashboard é¸åˆ° `main`ï¼Œç„¶å¾Œé»æ“Š "Promote a branch to production"ï¼Œå†é»æ“Š "Promote branch" å¦‚ä¸‹åœ–

![PlanetScale, promote-branch-main](/static/images/2022/promote-branch-main.png)

å°‡ main æå‡æˆ production branch å¾Œï¼Œå°±å¯ä»¥å†æ¬¡åŸ·è¡Œ `pscale deploy-request create personal-blog dev`

åŸ·è¡Œå¾Œæœƒå‡ºç¾ä¸€å€‹ deploy-request é€£çµï¼Œé»é–‹å¾Œç¢ºèªç„¡èª¤å°±å¯ä»¥é»æ“Šå·¦ä¸‹è§’ "Deploy changes" é€²è¡Œéƒ¨ç½²ï¼Œå¦‚ä¸‹åœ–

![PlanetScale, deploy-request](/static/images/2022/deploy-request.png)

å®Œæˆéƒ¨ç½²å¾Œå¦‚æœå‰›å‰›åœç•™çš„é é¢é‚„æ²’é—œæ‰ï¼Œæœƒæº«é¦¨æç¤ºå¯ä»¥åˆªé™¤ dev branchï¼Œå°±éš¨æ‰‹é»æ“Š "Delete branch" å§

é€™æ™‚åˆ° main branch æª¢æŸ¥ schemaï¼Œå¯ä»¥çœ‹åˆ° model ç¢ºå¯¦æ›´æ–°é€²ä¾†äº†

æ¥è‘—æˆ‘å€‘å°±å¯ä»¥åŸ·è¡Œ `pscale connect personal-blog main --port 3309`ï¼ŒæŠŠ localhost é€£ç·šæŒ‡åˆ° main åˆ†æ”¯ä¸Š

å¦‚æ­¤å°±æŠŠ table schema çš„éƒ¨åˆ†æå®šäº†ï¼Œä¸‹ä¸€æ­¥é–‹å§‹é€²è¡Œ API é–‹ç™¼

è£œå……ï¼šå¦‚æœ‰éœ€è¦å…ˆé€²è¡Œè³‡æ–™æ¸¬è©¦çš„è©±ï¼Œå¯ä»¥åŸ·è¡Œ `npx prisma studio` é€é UI ç›´æ¥æ“ä½œè³‡æ–™è¡¨ï¼Œå¦‚ä¸‹åœ–

![PlanetScale, deploy-request](/static/images/2022/prisma-studio.png)

## å»ºç«‹ CRUD API

é¦–å…ˆè¦å»ºç«‹ä¸€å€‹æª”æ¡ˆ `lib/prisma.ts`ï¼Œç¨‹å¼å¦‚ä¸‹

``` typescript
import { PrismaClient } from '@prisma/client'

// PrismaClient is attached to the `global` object in development to prevent
// exhausting your database connection limit.
// Learn more:
// https://pris.ly/d/help/next-js-best-practices

let prisma

if (process.env.NODE_ENV === 'production') {
  prisma = new PrismaClient()
} else {
  if (!global.prisma) {
    global.prisma = new PrismaClient()
  }
  prisma = global.prisma
}

export default prisma

```

é€™æ®µç¨‹å¼ç›®çš„åœ¨æ–¼é‡è¤‡ä½¿ç”¨ PrismaClient ç‰©ä»¶ï¼Œå¦‚æ­¤å¯é¿å…æ¯æ¬¡ request éƒ½å»ºç«‹æ–°çš„ connection

æ¥è‘—å»ºç«‹ file `pages/api/views/[slug].ts`

``` typescript
import prisma from 'lib/prisma'
import { NextApiRequest, NextApiResponse } from 'next'

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  try {
    const slug = req.query.slug.toString()
    
    if (req.method === 'POST') {
      const upsert = await prisma.views.upsert({
        where: { slug },
        create: { slug, },
        update: {
          count: { increment: 1, },
        },
      })

      return res.status(200).json({ total: upsert.count.toString(), })
    }

    if (req.method === 'GET') {
      const views = await prisma.views.findUnique({
        where: { slug, },
      })

      return res.status(200).json({ total: views?.count?.toString?.() || 0 })
    }
  } catch (e) {
    return res.status(500).json({ message: e.message })
  }
}

```

é€™æ®µç¨‹å¼å»ºç«‹ä¸€çµ„ APIï¼Œslug ç‚ºæ–‡ç«  URL

- POST /api/views/\[slug\]ï¼Œæ–°å¢ (count=1) æˆ–ä¿®æ”¹ (count++) ç€è¦½äººæ¬¡
- GET /api/views/\[slug\]ï¼Œè®€å–æ–‡ç« ç€è¦½äººæ¬¡

å»ºå¥½ä¹‹å¾Œå°±å¯ä»¥ç”¨ `http://localhost:3000/api/views` æ¸¬è©¦å›‰ï½  
(é™¤äº† API ä¹Ÿå¯ä»¥ç”¨å…ˆå‰æåˆ°çš„ `npx prisma studio` æª¢æŸ¥è³‡æ–™)

## å»ºç«‹ ViewCounter å…ƒä»¶

æ–°å»ºæª”æ¡ˆ `components/ViewCounter.tsx`ï¼Œç¨‹å¼å¦‚ä¸‹

``` tsx
import { useEffect } from 'react'
import useSWR from 'swr'
import fetcher from 'lib/utils/fetcher'

type ViewCounterProps = {
  slug: string
  className: string
  isBlogPage?: boolean
}

const ViewCounter = ({ slug, className, isBlogPage = false }: ViewCounterProps) => {
  const { data } = useSWR<{ total: unknown }>(`/api/views/${slug}`, fetcher)
  const views = new Number(data?.total)

  useEffect(() => {
    if (isBlogPage) fetch(`/api/views/${slug}`, { method: 'POST', })
  }, [isBlogPage, slug])

  return <span className={className}>{`${views > 0 ? views.toLocaleString() : 'â€“â€“â€“'}`}</span>
}

export default ViewCounter
```

é€™æ®µç¨‹å¼æœƒç”¢ç”Ÿä¸€å€‹ ViewCounter Componentï¼Œprops åˆ†åˆ¥æœ‰ä¸‹åˆ—åŠŸèƒ½
- `slug` ç”±å‘¼å«ç«¯å‚³å…¥æ–‡ç«  urlï¼Œå†å»æ‰“å…ˆå‰å®šç¾©å¥½çš„ç€è¦½äººæ¬¡ api
- `className` ç”±å‘¼å«ç«¯æ±ºå®š Componenet css class
- `isBlogPage` åªæœ‰é€²å…¥æ–‡ç« å…§å®¹æ‰æœƒæ‰“ `POST` apiï¼Œåä¹‹åœ¨åˆ—è¡¨é å°±ä¸æœƒæ‰“ `POST`ï¼Œæ‰€ä»¥ä¸æœƒå¢åŠ ç€è¦½äººæ¬¡

æ­¤å¤–é€™è£¡é‚„å®šç¾©äº†å…©å€‹ hookï¼Œ`useEffect` æ˜¯æ¯æ¬¡ Component (é‡æ–°)æ¸²æŸ“è§¸ç™¼ï¼Œ`useSWR` å‰‡æ˜¯ API å€¼æœ‰è®Šå‹•æ™‚è§¸ç™¼

å…¶ä¸­ `swr` éœ€å®‰è£èˆŠç‰ˆæœ¬ 1.1.2ï¼Œè‹¥å®‰è£è¼ƒæ–°ç‰ˆæœ¬æœƒå‡ºç¾è©­ç•°çš„ [react component éŒ¯èª¤](https://stackoverflow.com/questions/72061576/useswr-crashes-react-component)  
(æ’°æ–‡æ™‚çš„æœ€æ–°ç‰ˆæ˜¯ 1.3.0)  
(å®‰è£æŒ‡ä»¤: `npm i swr@1.1.2`)

`lib/utils/fetcher` æ˜¯è‡ªå®šç¾©çš„ç°¡å–® utility functionï¼Œç¨‹å¼å¦‚ä¸‹

``` typescript
export default async function Fetcher(input: RequestInfo | URL, init?: RequestInit) {
  const res = await fetch(input, init)
  return res.json()
}
```

## å°‡ ViewCounter å…ƒä»¶åŠ é€²ç›¸é—œ Layout

æœ€å¾Œä¸€æ­¥æŠŠ ViewCounter åŠ åˆ° `layouts/ListLayout.tsx`ã€`layouts/PostLayout.tsx` å°±å®Œæˆäº†

- `ListLayout.tsx` åˆ—è¡¨ä½ˆå±€
   - `isBlogPost` ç”¨é è¨­å€¼ `false` (ä¸æœƒå‘¼å« `POST` æ›´æ–°ç€è¦½äººæ¬¡)
   - å®£å‘Šç¯„ä¾‹ --> `<ViewCounter className="mx-1" slug={slug} />`

- `PostLayout.tsx` æœ¬æ–‡ä½ˆå±€
   - `isBlogPost` å¸¶å…¥ `true` (æœƒå‘¼å« `POST` æ›´æ–°ç€è¦½äººæ¬¡)
   - å®£å‘Šç¯„ä¾‹ --> `<ViewCounter className="ml-0" slug={slug} isBlogPage={true} />`

é€™æ¨£å°±å¤§åŠŸå‘Šæˆå•¦ ğŸ‰ğŸ‰

## ç¸½çµ

æœ¬ä¾†åªæ˜¯æƒ³åŠ å…¥æ–‡ç« ç€è¦½äººæ¬¡åŠŸèƒ½ï¼Œå»æ„å¤–çš„è¸ä¸Š serverless DBaaS æ—…ç¨‹

é¦–å…ˆæˆ‘å€‘è¨»å†Šäº† PlanetScale å¸³è™Ÿï¼Œå»ºç«‹ä¸€å€‹ MySQL database

å†ä½¿ç”¨ Prisma framework ä¸²æ¥ PlanetScaleï¼Œé€é framework æ›´æ–°è³‡æ–™è¡¨çµæ§‹ (table schema)

æ¥è‘—å»ºç«‹ä¸€çµ„ Next.Js APIï¼Œé€šé Prisma å»è®€å–/ æ›´æ–°æ–‡ç« ç€è¦½äººæ¬¡

ç„¶å¾Œå»ºç«‹ ViewCounter componentï¼Œé‹ç”¨ `useSWR`/ `useEffect` å…©å€‹ hook å»å‘¼å« API

æœ€å¾ŒæŠŠ ViewCounter åŠ åˆ°ç›¸é—œ Layout å®Œæˆäº†æ•´å€‹åŠŸèƒ½é–‹ç™¼

## å¾Œè¨˜

æ•´å€‹é–‹ç™¼é«”é©—ç®—æ˜¯å¾ˆæ–°å¥‡ï¼Œå°¤å…¶ pscale CLI å¯ä»¥ç”¨ localhost proxy åˆ°é›²ç«¯ï¼Œç”šè‡³åš db branches

å¦å¤– prisma ä¹Ÿç®—æ˜¯æˆç†Ÿçš„ ORM frameworkï¼Œé™¤äº† db é€£ç·šã€schema migrationã€CRUD ç­‰åŸºæœ¬åŠŸèƒ½

é‚„æä¾›äº† `npx prisma studio` ç¶²é ä»‹é¢ï¼Œè®“é–‹ç™¼äººå“¡å¯ä»¥å°è³‡æ–™è¡¨ç›´æ¥é€²è¡Œæ“ä½œ

ç›¸ä¿¡å¦‚æœè®€è€…å’Œæˆ‘ä¸€æ¨£ï¼Œéå»åªæœ‰å‚³çµ± web solution ç¶“é©—ï¼Œä¹Ÿæœƒæœ‰é€²å…¥é­”æ³•æ£®æ—çš„æ„Ÿè¦º ğŸ¦„ğŸ¦„

ä½†æ–°æ±è¥¿ä¼´éš¨çš„ç¼ºé»å°±æ˜¯è³‡æ–™å°‘ï¼Œdebug é è‡ªå·±ï¼Œåƒæ˜¯å‰é¢æåˆ° `useSWR` react componenet éŒ¯èª¤å°±èŠ±è²»äº†å¾ˆå¤šæ™‚é–“

å› ç‚ºéŒ¯èª¤è¨Šæ¯è·Ÿ `swr` æ²’æœ‰ç›´æ¥é—œä¿‚ï¼ŒæŠŠéŒ¯èª¤è¨Šæ¯æ‹¿å»ä¼°ç‹—åè€Œæœƒå¾€ "éŒ¯èª¤" çš„æ–¹å‘é‘½

æœ€å¾Œæ˜¯ä¸€è¡Œä¸€è¡Œ debug æ‰çŸ¥é“æ˜¯ `swr` åœ¨æé¬¼ï¼Œæ‰€å¹¸ SO æœ‰ç›¸é—œè¨è«–ï¼Œå°±æ›´ç¢ºå®šé™ç‰ˆèƒ½è§£æ±ºå•é¡Œ

## åƒè€ƒè³‡æ–™

- David Parks: [Deploying a PlanetScale, Next.js & Prisma App to Vercel](https://davidparks.dev/blog/planetscale-deployment-with-prisma/#setup)
- Parth Desai: [GitHub, ycoder2000 / blog](https://github.com/pycoder2000/blog)