---  
title: 'å»å§é€²åº¦æ¢ï¼äººç”Ÿç¬¬ä¸€å€‹ react componentï¼Œå°±æ±ºå®šæ˜¯ä½ äº†'
date: '2022-08-22'
lastmod: '2022-08-22'
tags: ['build-a-blog', 'blog-functions', 'react', 'tailwind-css', 'tech-skills-basic']
draft: false
summary: 'æœ¬æ–‡ä½¿ç”¨ TailwindCss ä»¥åŠ React Component ç°¡å–®è£½ä½œäº†ä¸€å€‹é–±è®€é€²åº¦æ¢'
images: []
---

## é©åˆé–±è®€å°è±¡

- å…·å‚™åŸºç¤ç¨‹å¼èƒ½åŠ›
- react èœé³¥
- å®¹æ˜“è¢«å°æ±è¥¿è¿·æƒ‘çš„äºº

## ç·´ç¿’ç›®æ¨™ â€”â€” é–±è®€é€²åº¦æ¢

æ¯æ¬¡é€›å…¶ä»–çš„äººçš„éƒ¨è½æ ¼ï¼Œç¸½æ˜¯æœƒè¢«ä¸€äº›é…·ç‚«çš„å°åŠŸèƒ½çµ¦è¿·æƒ‘ï¼Œé€™æ¬¡è¿·æƒ‘çš„å°è±¡æ˜¯é€™å€‹ ğŸ‘‡

<ImageWithCap
  alt="reading-progress-bar"
  src="https://i.imgur.com/WIjYLuM.gif"
  cap="Screen record from [Parth Desai](https://musing.vercel.app/blog/spotify-refresh-token)"
  />

é–±è®€é€²åº¦æ¢ï¼Œç•¶ä½ æ³¨æ„åˆ°ä¹‹å¾Œï¼Œå°±å†ä¹Ÿç„¡æ³•å¿½è¦–çš„å°æ±è¥¿

ä»Šå¤©å°±ä¾†çœ‹çœ‹è¦å¦‚ä½•ç”¨ react componentï¼Œè‡ªå·±åˆ»ä¸€å€‹é–±è®€é€²åº¦æ¢å§ï½

## Step 1 å»ºç«‹ react compoenet

é¦–å…ˆé™„ä¸Šæºç¢¼ (~~è¤‡è£½è²¼ä¸ŠçµæŸé€™å›åˆ~~)

``` tsx
//filename: components/ReadingBar.tsx
import { useState, useEffect } from "react";
export default function ReadingBar() {
  const [width, setWidth] = useState(0);
  const updateWidthOnScroll = () => {
    const curY = window.scrollY;
    const totalY = document.body.scrollHeight - window.innerHeight;
    if(!curY || !totalY) return setWidth(0)
    if (curY > totalY) return setWidth(100)
    setWidth((curY / totalY) * 100);
  }
  useEffect(() => {
    window.addEventListener("scroll", updateWidthOnScroll);
    return () => window.removeEventListener("scroll", updateWidthOnScroll);
  }, []);
  return <div className="fixed h-1 z-30 bg-gradient-to-r from-cyan-500 to-blue-500" style={{ width: width + '%' }} />;
}
```

## Step 2 è£œèª²æ™‚å…‰

å° react ä¸ç†Ÿçš„è®€è€…è¦å…ˆäº†è§£ä¸€ä¸‹ component ä¸‰è¦ç´ 

### 1. function or class declaration

Component å¯ä»¥è¢«å®£å‘Šæˆ function æˆ– classï¼Œå…¶ä¸­ class æ˜¯èˆŠå¯«æ³•ï¼Œå› ç‚ºå¯«æ³•ä¸æ˜“ç¶­è­·å·²é€æ¼¸æ£„ç”¨ï¼Œæ–°æœ‹å‹å°±å¤šå¤šä½¿ç”¨ function æ ¼å¼å§

Component å®šç¾©å¾Œå°±èƒ½ä½¿ç”¨åœ¨ä»»ä½• tsx (å…¶ä»– components)ï¼Œèªæ³•å¦‚å³ `<ReadinngBar />`

Function å¯ä»¥å®£å‘Š parametersï¼Œç”±å‘¼å«ç«¯å‚³å…¥åƒæ•¸ï¼Œä¾‹å¦‚ï¼š`<ReadingBar isShow={false} />`

Fuction éƒ¨ä»½å°±è¦å®šç¾©æˆ `function ReadingBar(isShow: boolean) { ... }`ï¼Œé€™é‚Šæš«æ™‚ä¸æœƒç”¨åˆ°é€™å€‹ç‰¹æ€§

### 2. hooks

function æ ¼å¼ç¨æœ‰çš„æ–°æ±è¥¿ï¼Œå°æ‡‰åˆ° class å°±æ˜¯ `componentDidMount`ã€`componentWillUnmount` é€™äº›äº‹ä»¶

useXxx é–‹é ­çš„ functionsï¼Œåƒæ˜¯ `useState`, `useEffect` é€™äº›éƒ½å±¬æ–¼ hooks

hooks æ˜¯æœ‰ callback (event) æ„ç¾©çš„ functions

ä»¥ `useEffect` ç‚ºä¾‹ï¼Œæ¯æ¬¡ component render ä¹‹å¾Œå°±æœƒè§¸ç™¼ä¸€æ¬¡ï¼Œç­‰åŒæ–¼ class `componentDidMount`ã€`componentDidUpdate`

è€Œ `componentWillUnmount` å‰‡éš±å«åœ¨ `useEffect` return function

ç•¶ä½¿ç”¨ `useEffect` æ²’æœ‰ return çš„è©±ï¼Œå°±ç­‰æ–¼ component å°‘äº† unmount æ¸…é™¤äº‹ä»¶å–”

`useState` æ˜¯å¦ä¸€å€‹é•·ç›¸å¥‡ç‰¹çš„ functionï¼ŒåŠŸèƒ½æ˜¯çµ¦å…ƒä»¶ç¶å®šä¸€å€‹ç‹€æ…‹ï¼Œå‡å¦‚ç‹€æ…‹å€¼æ”¹è®Šï¼Œå°±æ›´æ–° component å°æ‡‰çš„å±¬æ€§

`useState` æœ‰ä¸‰å€‹å…ƒç´ ï¼Œä»¥ `const [width, setWidth] = useState(0);` ç‚ºä¾‹å­

`width` è¡¨ç¤ºç¶å®šåœ¨å…ƒä»¶ä¸Šçš„è®Šæ•¸ï¼›`setWidth` æ˜¯å°ˆé–€ç”¨æ–¼ä¿®æ”¹ `width` å€¼çš„ functionï¼›`0` è¡¨ç¤ºç‹€æ…‹é è¨­å€¼

### 3. return jsx (Javascript XML)

å¦ä¸€å€‹ react ç¥å¥‡çš„æ©Ÿåˆ¶ï¼Œå¯ä»¥åœ¨ javascript è£¡å®£å‘Š html tagsï¼Œç”šè‡³å¯ä»¥åœ¨ tags ç©¿æ’å¤§æ‹¬è™Ÿ '{}'ï¼Œåˆ‡æ›æˆ js èªæ³•

ä»¥ `return <div style={{ width: widthResult + '%' }} />` ç‚ºä¾‹å­ï¼Œå°±æ˜¯å°‡ä¸€å€‹ js object å¡åˆ° style å±¬æ€§

è—‰æ­¤å°‡ `div` `style.width` å±¬æ€§æ›´æ–°æˆè®Šæ•¸ `widthResult`

æ­¤å¤–ï¼Œç¥å¥‡çš„å¤§æ‹¬è™Ÿä¹Ÿå¯ä»¥åšè¿´åœˆã€æ¢ä»¶ç­‰è™•ç†ï¼Œé€™é‚Šæš«æ™‚ä¸æœƒç”¨åˆ°é€™äº›ç‰¹æ€§

React ä¸å…è¨±åœ¨ return statement å›å‚³æ•¸å€‹ element

ä¾‹å¦‚ `return ( <p>first</p> <p>second</p> )` é€™æ¨£çš„å¯«æ³•å°±æœƒå ±éŒ¯

ä¸€å€‹å¯¦ç”¨æŠ€å·§æ˜¯æŠŠæ•¸å€‹ element ç”¨è™›æ“¬ç¯€é» `<> </>` åŒ…èµ·ä¾†

å¦‚å³ `return ( <> <p>first</p> <p>second</p> </> )`ï¼Œé€™æ¨£å°±èƒ½å¤ é€šéç·¨è­¯

## Step 3 è¨ˆç®— ScrollY

è£œå®Œèª²å†ä¾†é–±è®€ç¨‹å¼ï¼Œç™¼ç¾çœŸçš„éœ€è¦äº†è§£çš„éƒ¨åˆ†åªå‰©ä¸‹ ScrollY è¨ˆç®—ï¼Œå…¶é¤˜éƒ¨åˆ†éƒ½å¯å¾å­—é¢è§£è®€

`useState` å°±æ˜¯å®£å‘Šéœ€è¦ç¶å®šçš„ç‹€æ…‹ï¼Œ`useEffect` å°±æ˜¯è¨»å†Š onScroll äº‹ä»¶

æ¥è‘—å°±ä¾†çœ‹é‡é»ç¨‹å¼ï¼Œçµè«–é‚„æ˜¯å­—é¢ä¸Šå¯è§£è®€ XDD

é€™é‚Šé‡é»æ‡‰è©²æ˜¯ç‰©ä»¶å±¬æ€§æœ‰å¾ˆå¤šåŒç¾©è©ï¼Œæˆ‘å°šæœªç´°ç´°å»ç ”ç©¶éï¼Œä¹Ÿè¨±è·Ÿç€è¦½å™¨æ”¯æ´åº¦æœ‰é—œ

åƒæ˜¯ `window.scrollY` å°±å¯ä»¥æœ‰ `window.pageYOffset`ã€`document.documentElement.scrollTop`ã€`document.body.scrollTop` é€™éº¼å¤šè®ŠåŒ–

`document.body.scrollHeight` è·Ÿ `document.documentElement.scrollHeight` äº’é€š

`window.innerHeight` èˆ‡ `document.documentElement.clientHeight` äº’é€š

ä¹‹å¾Œæœ‰æ©Ÿæœƒå†å¯«æ–‡ç« æ·±å…¥ç ”ç©¶ï½

``` tsx
const updateWidthOnScroll = () => {
  const curY = window.scrollY;
  const totalY = document.body.scrollHeight - window.innerHeight;
  if(!curY || !totalY) return setWidth(0)
  if (curY > totalY) return setWidth(100)
  setWidth((curY / totalY) * 100);
}
```

## Step 4 è¨­è¨ˆ

å› ç‚ºæœ‰ç”¨ TailwindCss å°±ç›´æ¥ä¸²æ»¿ utility classes äº†

åœ¨é€™é‚Šæ¯”å°ä¸€ä¸‹å„ç¨®å¯«æ³•å·®ç•°

``` tsx
// 1. TailwindCss
const tw = (<div className="fixed h-1 z-30 bg-gradient-to-r from-cyan-500 to-blue-500" />)

// 2. styled-components
const Sc2 = styled.div`
  position: fixed;
  height: 0.25rem;
  z-index: 30;
  background-image: linear-gradient(to right, #06b6d4, #3b82f6);
`
const sc = (<Sc2 />)

// 3. style object
const so = {
  position: 'fixed',
  height: '0.25rem',
  zIndex: 30,
  backgroundImage: 'linear-gradient(to right, #06b6d4, #3b82f6)'
}
const so2 = (<div style={so}>)
```

å…¶ä¸­ç¬¬äºŒç¨®éœ€è¦å®‰è£ package "styled-components"

é‚„æœ‰ç¬¬å››ç¨®å¯«æ³•æ˜¯ç›´æ¥ inline å­—ä¸²åˆ° styleï¼Œä½†æˆ‘æƒ³ TailwindCss æ‡‰è©²å¯ä»¥å®Œç¾å–ä»£é€™ç¨® case

å€‹äººæ˜¯åå¥½ç¬¬ä¸€ç¨®ï¼Œå°¤å…¶åœ¨ vscode æœ‰å®‰è£ TailwindCss Intellisense çš„æƒ…æ³ï¼Œé–‹ç™¼å°±æ˜¯å¿«ï½


## Step 5 å¯¦è£åˆ°é é¢ä¸Š

é–‹å•Ÿ `components/LayoutWrapper.tsx`ï¼Œèª¿æ•´ç¨‹å¼ç¢¼å¦‚ä¸‹

![reading-bar-plugin.png](/static/images/2022/reading-bar-plugin.png)

åŠ åœ¨é€™çš„ä¸»è¦åŸå› æ˜¯ï¼Œ`<ReadingBar />` éœ€è¦è¢«æ”¾åœ¨æœ€ä¸Šå±¤å®¹å™¨ï¼Œå¦‚æœæˆ‘å€‘åŠ åœ¨ `layouts/PostLayout.tsx`

é€²åº¦æ¢å°‡æœƒå—é™åœ¨å…§æ–‡å®¹å™¨çš„å¯¬åº¦ (å°±è·Ÿ `<DesktopNav />` ä¸€æ¨£ï¼Œå¯¬åº¦éœ€è¦æ’é–‹æ•´å€‹ç•«é¢)

å¦ä¸€å€‹äº®é»æ˜¯ `useRouter`ï¼Œé€™æ˜¯ç‚ºäº†æ§åˆ¶é€²åº¦æ¢åªæœ‰åœ¨ "é–±è®€æ–‡ç« " çš„æ™‚å€™å‡ºç¾

`{isBlogPost && <ReadingBar />}` é€™å€‹æ˜¯ conditional rendering çŸ­å¯«æ³•

è‹¥å·¦é‚Šç‚º true å‰‡ render componentï¼›è‹¥å·¦é‚Šç‚º false å‰‡ä¸åš render

æˆå“å¦‚ä¸‹åœ– ğŸ‰ğŸ‰

![reading-bar-final.gif](https://i.imgur.com/VPby3aZ.gif)

## çµè«–

æœ¬æ–‡ä½¿ç”¨ TailwindCss ä»¥åŠ React Component ç°¡å–®è£½ä½œäº†ä¸€å€‹é–±è®€é€²åº¦æ¢

React éƒ¨åˆ†è¤‡ç¿’äº† function componentã€hooks ä»¥åŠ jsx

è¨­è¨ˆçš„éƒ¨åˆ†ä½¿ç”¨äº† TailwindCssï¼Œä¸¦ç¨å¾®æ¯”è¼ƒäº†å…¶ä»–æ’°å¯«æ–¹æ³•

æœ€å¾Œå†æŠŠ component å¯¦è£åˆ° `LayoutWrapper`ï¼Œä¸¦åŠ ä¸Š route åˆ¤æ–·ï¼Œç¢ºä¿é€²åº¦æ¢åªæœ‰åœ¨é–±è®€æ–‡ç« æ™‚æœƒå‡ºç¾

### å¾Œè¨˜

åšå®Œé€™å€‹åŠŸèƒ½æ‰ç™¼ç¾è·Ÿæ—¢æœ‰åŠŸèƒ½è¡çªäº†ï¼Œä¹‹å‰è¢«æ¥µç°¡é¢¨ä¸»é¡Œè¿·æƒ‘æ™‚åŠ äº†ä¸€å€‹æ²è»¸åŠŸèƒ½

--> ä¸‹æ²æ™‚éš±è— NavBarï¼›ä¸Šæ²é¡¯ç¤º NavBar

ç¾åœ¨åŠ äº†é€²åº¦æ¢ä¹‹å¾Œï¼Œç™¼ç¾é€™åŠŸèƒ½æ˜é¡¯é˜¿é›œ ğŸ˜“ğŸ˜“

æœç„¶è¨­è¨ˆçš„ç´ é¤Šå°±æ˜¯ä¸èƒ½åˆ°è™•è¢«è¿·æƒ‘å•Šï½

## åƒè€ƒè³‡æ–™

- CodeSandbox: [React Reading Progress Bar](https://codesandbox.io/s/i0k8e8?file=/src/Components/ReadingBar.js)
- TailwindCss docs: [Gradient Color Stops](https://tailwindcss.com/docs/gradient-color-stops)
- ReactJs docs: [Conditional Rendering](https://en.reactjs.org/docs/conditional-rendering.html#inline-if-with-logical--operator)