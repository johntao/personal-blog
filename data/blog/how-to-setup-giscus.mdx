---
title: éƒ¨è½æ ¼ä¸²æ¥ giscus ç•™è¨€æ¿æœå‹™
date: '2022-08-12'
lastmod: '2022-08-12'
tags: ['build-a-blog', 'blog-functions', 'step-by-step', 'tech-skills-basic']
draft: false
summary: 'é€æ­¥ä»‹ç´¹åœ¨ next.js blog starter è¦å¦‚ä½•ä¸²æ¥ giscus ç•™è¨€æ¿æœå‹™'
images: []
---

## é©åˆé–±è®€å°è±¡

- å…·å‚™åŸºç¤ç¨‹å¼èƒ½åŠ›
- å·²ç¶“æ¶å¥½ next.js blog ä½†é‚„æ²’è¨­å®šç•™è¨€æ¿çš„ä½ 
- è½é disqus or giscus æœå‹™ä½†éƒ½æ²’ä¸²æ¥éçš„ä½ 

## å‰è¨€ (ä»€éº¼æ˜¯ giscus)

æœ¬ç«™ä½¿ç”¨ [next.js blog starter pack](https://github.com/timlrx/tailwind-nextjs-starter-blog) é è¨­æœ‰æä¾› disqus/ giscus å…©ç¨®ç•™è¨€æ¿æœå‹™çš„æ¥å£

é€™é‚Šæš«ä¸è¨è«– disqusï¼Œæœæ–·é¸ç”¨ giscusï¼Œå› ç‚º github æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„å·¥ç¨‹å¸«(~~åŒæ€§~~)äº¤å‹ç¶²ç«™

giscus æ˜¯åŸºæ–¼ __GitHub Discussions__ çš„é–‹æºç•™è¨€æ¿æœå‹™

ç‰¹é»æœ‰
- å…è²»ã€ç„¡å»£å‘Šã€ç„¡è¿½è¹¤å™¨
- ä¸éœ€è¦è³‡æ–™åº«ï¼Œæ‰€æœ‰è³‡æ–™éƒ½å­˜æ”¾åœ¨ GitHub Discussions
- æ”¯æ´é»‘æš—ä¸»é¡Œ
- æ”¯æ´å¤šç¨®èªè¨€
- å³æ™‚åŒæ­¥ GitHub Discussions è³‡æ–™æ›´å‹•
- æ”¯æ´æœ¬åœ°æ¶è¨­æœå‹™ (Self-hosted)

## giscus å®‰è£æ¢ä»¶ (install prerequisite)

ä¸€é–‹å§‹ä»€éº¼éƒ½æ²’è¨­å®šæ™‚ï¼Œé»æ“Š __Load Comments__ æœƒå‡ºç¾éŒ¯èª¤è¨Šæ¯ __An error occurred: giscus is not installed on this repository__

é–‹å•Ÿæª”æ¡ˆ `./data/siteMetadata.js` ç¢ºèª `comment` ç›¸é—œè¨­å®š (å¦‚ä¸‹åœ–)

![æª”æ¡ˆ siteMetadata.js ç¨‹å¼ç¢¼ç‰‡æ®µï¼Œå±¬æ€§ siteMetadata.comment](/static/images/2022/site-metadata-comment.png)

ç¢ºèª provider æœ‰è¨­ç½®æ­£ç¢ºï¼Œæ ¹æ“šè¨»è§£æç¤ºèµ°è¨ª [giscus é é¢](https://giscus.app/) çœ‹åˆ° Configuration å€å¡Š (å¦‚ä¸‹åœ–)  

![giscus app ç¶²é ï¼ŒConfiguration å€å¡Š](/static/images/2022/giscus-app-configuration.png)

è¨­ç½®ç•™è¨€å€çš„èªç³» (ç›®å‰è¨­ç‚ºè‹±æ–‡)ï¼Œæ¥è‘—å¾€ä¸‹çœ‹åˆ° Repository å€å¡Š

ç¬¬ä¸€é»ï¼Œç¢ºèª Repository è¨­ç‚º public (å·²ç¶“æ˜¯äº†)

ç¬¬äºŒé»ï¼Œé»æ“Šé€£çµå®‰è£ [giscus app](https://github.com/apps/giscus)

å®‰è£æ™‚æœƒè©¢å•è¦å…¨ repository (åº«) å®‰è£æˆ–æ˜¯è£åœ¨ç‰¹å®šåº«ï¼Œæˆ‘é¸æ“‡åªè£åœ¨éƒ¨è½æ ¼çš„åº«

ç¬¬ä¸‰é»ï¼Œç¢ºèªåº«çš„ "Discussions" åŠŸèƒ½æœ‰æ‰“é–‹ï¼Œé»é–‹ç•«é¢ä¸Šçš„é€£çµ [enabling if for your repository](https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/enabling-or-disabling-github-discussions-for-a-repository#enabling-or-disabling-github-discussions-for-your-repository) (å¦‚ä¸‹åœ–)

![GitHub Docs, Enabling or disabling GitHub Discussions for a repository](/static/images/2022/enable-it-for-your-repository.png)

ä¾ç…§å…§æ–‡æ­¥é©Ÿé–‹å•Ÿåº«çš„ Discussions åŠŸèƒ½

## è¨­å®š giscus (configuration)

å›åˆ° giscus app é é¢è¼¸å…¥ä½ çš„ä½¿ç”¨è€…åç¨±å’Œåº«åï¼Œè‹¥æ­¥é©Ÿéƒ½æ­£ç¢ºåŸ·è¡Œï¼Œæœƒå‡ºç¾é€šéæª¢æ ¸çš„æç¤º (å¦‚ä¸‹åœ–)

![Giscus app, repository match all criteria to enable giscus](/static/images/2022/repository-match-giscus-criteria.png)

æ¥è‘—çœ‹åˆ° "Page â†”ï¸ Discussions Mapping" å€å¡Šï¼Œä¿®æ”¹é€™è£¡æœƒå½±éŸ¿å¾Œé¢ config è‡ªå‹•ç”¢ç”Ÿå¸¶å‡ºä¾†çš„å€¼

æ²’ç ”ç©¶å…¶ä»–é¸é …çš„å·®ç•°ï¼Œå¯ä»¥å…ˆç•¥éé€™æ®µï¼Œç›´æ¥ä½¿ç”¨é è¨­å€¼ `pathname`

æ¥è‘—çœ‹åˆ° "Discussion Category" å¦‚ä¸‹åœ–

![Giscus app, Discussion Category](/static/images/2022/giscus-discussion-category.png)

é€™å€‹æ˜¯å¿…å¡«æ¬„ä½ï¼Œè·Ÿå‰ä¸€æ­¥ä¸€æ¨£ï¼Œä¿®æ”¹æœƒå½±éŸ¿ config æœ€å¾Œç”¢å‡ºçš„å€¼ï¼Œé€™é‚Šæˆ‘é¸ General

æ¥è‘—çœ‹åˆ° "Features" å€å¡Šï¼Œé€™é‚Šæˆ‘æ²’æ”¹å‹•ç›´æ¥ä½¿ç”¨é è¨­å€¼

"Theme"ï¼Œä¸€æ¨£é è¨­å€¼ GitHub Light

æœ€å¾Œçœ‹åˆ° "Enable giscus" å€å¡Šï¼Œé€™è£¡å°±æ˜¯å‰é¢æåˆ°è‡ªå‹•ç”¢ç”Ÿçš„ config (å¦‚ä¸‹åœ–)

![Giscus app, Enable giscus](/static/images/2022/enable-giscus.png)

## å¥—ç”¨ giscus api èˆ‡è¨­å®š Vercel ç’°å¢ƒè®Šæ•¸

ç†è«–ä¸Šé€™è£¡çš„ script æ˜¯çµ¦é–‹ç™¼è€…æ”¾åœ¨ç¶²é ä¸Šï¼ŒåŸ·è¡Œå¾Œå°±æœƒæ‰“é€š giscus æœå‹™ï¼Œç„¶å¾Œç•™è¨€æ¿

ä½†æˆ‘å€‘æœ‰å¥—ç”¨ next.js æ¡†æ¶ï¼Œæ¡†æ¶æœƒå¹«å¿™å¯«å…¥ scriptï¼Œæ‰€ä»¥é€™è£¡åªéœ€è¦å…ˆè¨˜æ†¶æœ‰é€™å››å€‹å¿…è¦åƒæ•¸

- data-repo=
- data-repo-id=
- data-category=
- data-category-id=

ç„¶å¾Œï¼Œå›åˆ°å‰é¢çš„ `siteMetadata.js` ~~æŠŠåƒæ•¸å¤§è†½è²¼ä¸Š~~ å°±éŒ¯äº†ï¼

é€™å››å€‹åƒæ•¸å±¬æ–¼æ•æ„Ÿè¨Šæ¯ï¼ˆå…¶å¯¦æ²’æœ‰å¾ˆæ•æ„Ÿï¼Œæˆ‘å€‘å…ˆä¿æŒæƒ³åƒä»–å¾ˆæ©Ÿå¯†ï¼‰

æ‰€ä»¥ä¸æœƒå¯«æ­»åœ¨é€™ï¼Œå¯¦éš›ä¸Šæœƒåœ¨ Vercel éƒ¨ç½²æ™‚ï¼Œç”¨ç’°å¢ƒè®Šæ•¸æ–¹å¼å¯«å…¥
``` javascript
giscusConfig: {
   repo: process.env.NEXT_PUBLIC_GISCUS_REPO,
   repositoryId: process.env.NEXT_PUBLIC_GISCUS_REPOSITORY_ID,
   category: process.env.NEXT_PUBLIC_GISCUS_CATEGORY,
   categoryId: process.env.NEXT_PUBLIC_GISCUS_CATEGORY_ID
}
```

å¯ä»¥çœ‹åˆ° `provider: 'giscus',` é€™è¡Œä¸Šé¢è¨»è§£æåˆ°çš„é€£çµ

`https://vercel.com/docs/environment-variables` é€£çµé»é–‹å¦‚ä¸‹åœ–

![Vercel, Environment variables](/static/images/2022/declare-an-environment-variable.png)

æ¥è‘—ä¾æ­¥é©ŸæŒ‡ç¤ºï¼Œå°‡å››å€‹åƒæ•¸æ–°å¢åˆ°ç’°å¢ƒè®Šæ•¸ï¼Œå®Œæˆå¾Œçš„æ¨£å­å¦‚ä¸‹åœ–æ‰€ç¤º

![Vercel, Environment variables all set](/static/images/2022/vercel-environment-variables.png)

è£œå……ï¼šå¦‚æœç’°å¢ƒè®Šæ•¸å€¼æœ‰ä¿®æ”¹çš„è©±ï¼Œç«™å°å¿…é ˆ "Redeploy" æ‰æœƒå¥—ç”¨å–”

## Troubleshooting

ç†è«–ä¸Šåˆ°é€™å°±å¤§åŠŸå‘Šæˆäº†ï¼Œä½†é–‹å•Ÿç•™è¨€æ¿å¾Œä¾ç„¶å‡ºç¾éŒ¯èª¤

![Giscus, still error](/static/images/2022/giscus-still-error.png)

æ­¤æ™‚è’é«’çš„æœå°‹ "giscus.app refused to connect." ä¸æœƒå¾—åˆ°æœ‰ç”¨çš„è³‡è¨Š

å¿…é ˆæ·¡å®šçš„é–‹å•Ÿ DevTools æª¢æŸ¥å…ƒç´ ï¼Œé»é¸ç•™è¨€æ¿çš„ä½ç½®ï¼Œç™¼ç¾ iframe src æ€ªæ€ªçš„  
``` html
<iframe class="giscus-frame" src="https://giscus.app/undefined/widget?origin=...ç•¥" />
```

Url ä¸­å‡ºç¾è¿·æ¨£çš„ `undefined`

![Meme: Confused Face](/static/images/meme-confused-face.jpeg)

é€™æ™‚è’é«’èˆ‡æ·¡å®šéƒ½ç„¡æ¿Ÿæ–¼äº‹ï¼Œæˆ‘å€‘éœ€è¦çš„æ˜¯ç§‘å­¸æ€§çš„ç‹‚é‡å‡è¨­  

ä»”ç´°ä¸€çœ‹ï¼Œ`undefined` å‡ºç¾çš„ä½ç½®ï¼Œå¾ˆåƒæ˜¯ routing ä¸­ç¼ºå°‘äº†æŸå€‹åƒæ•¸ï¼Œçœ‹èµ·ä¾†å°±æ˜¯å°‘äº† en, zh ä¹‹é¡çš„å¤šèªä»£ç¢¼

é¦¬ä¸Šå›åˆ°[æ–°æ‰‹åŒ…çš„æºå§‹ç¢¼](https://github.com/timlrx/tailwind-nextjs-starter-blog/blob/master/data/siteMetadata.js)ï¼Œæ‰¾åˆ° `giscusConfig` å€å¡Š

ç¨å¾®æ¯”å°å¾Œç™¼ç¾æˆ‘å€‘çš„ç‰ˆæœ¬å°‘äº† `lang: 'en',`ï¼Œæ¨è«–ç•¶æ™‚ typescript åˆ†æ”¯çš„ç‰ˆæœ¬ï¼Œä¸éœ€è¦ `lang` åƒæ•¸ä¹Ÿèƒ½é‹ä½œ

æŠŠé€™è¡Œè£œä¸Šå¾Œï¼Œå°±æ‰“å®Œæ”¶å·¥å•¦

## å¾Œè¨˜

ç›®å‰æˆ‘å€‘ç”¨çš„ #contentlayer åˆ†æ”¯ï¼Œé›–ç„¶æœ‰ typescript å¾ˆé¦™ï¼Œä½†ä¹Ÿè½å¾Œä¸»å¹¹ 371 å€‹ commits (å¦‚ä¸‹åœ–)

![tailwind-nextjs-starter-blog branch #contentlayer](/static/images/2022/branch-content-layer.png)

è½å¾Œé€™éº¼å¤šçš„ç†ç”±æœ‰å¾ˆå¤šï¼Œå¯èƒ½æ˜¯å¿˜äº†åˆä½µæˆ–æ²’æ™‚é–“åˆä½µï¼Œæœ€ç³Ÿçš„æƒ…æ³å°±æ˜¯ç¨‹å¼å·®ç•°å¤ªå¤§ï¼Œæ ¹æœ¬ç„¡æ³•åˆä½µ

è¡ç”Ÿå•é¡Œå°±åƒæˆ‘å€‘é€™è£¡é‡åˆ°çš„ `lang`ï¼Œå¦‚æœæŒçºŒç™¼ç”Ÿå°é–‹ç™¼è€…ä¾†èªªæœƒæ˜¯å¾ˆå¤§çš„å›°æ“¾

ç›®å‰æˆ‘èƒ½æƒ³åˆ°çš„å¹¾ç¨®è§£æ±ºè¾¦æ³•

1. ç¶­æŒä¸€å€‹åº«ï¼Œä¸€é–‹å§‹å°±ç¢ºå®šå…©ç¨®èªè¨€ä¸¦è¡Œï¼Œæ‰€æœ‰ feature å¯¦ä½œå…©éï¼Œå¦‚æ­¤å°±ä¸éœ€è¦å› ç¨‹å¼èªè¨€ä¸åŒè€Œåˆ‡å‡ºåˆ†æ”¯
1. æ‹†æˆå…©å€‹åº«ï¼Œä¸€ç¨®ç¨‹å¼èªè¨€ä¸€å€‹åº«ï¼Œæ‰€æœ‰ feature é‚„æ˜¯è¦å¯¦ä½œå…©éï¼Œä¸éœ€è¦å› ç¨‹å¼èªè¨€åˆ‡åˆ†æ”¯
1. ç¶­æŒä¸€å€‹åº«ï¼Œåªç”¨ä¸€ç¨®ç¨‹å¼èªè¨€ (A)ï¼Œå¦ä¸€ç¨®èªè¨€ (B) ç”±å·¥å…·è½‰æ›ç”¢ç”Ÿï¼Œæ‰€æœ‰ feature åªéœ€è¦å¯¦ä½œä¸€é
1. ç¶­æŒä¸€å€‹åº«ï¼Œåªç”¨ä¸€ç¨®èªè¨€ï¼Œå¦ä¸€ç¨®èªè¨€å¿ç—›æ”¾æ£„

å…¶ä¸­ä¸€äºŒæœ¬è³ªä¸Šæ˜¯æ²’æœ‰è§£æ±ºå•é¡Œçš„ï¼Œåˆ†æ”¯è®Šå¥½çœ‹ä½†ç¨‹å¼éƒ½è¦å¯«å…©ä»½

ç¬¬ä¸‰ç¨®ä½œæ³•æ˜¯å …å®šä¸€å€‹åº«ä¸€ç¨®èªè¨€ï¼Œæœ‰éœ€è¦è½‰æ›çš„äººåœ¨é–‹ç™¼éšæ®µè‡ªè¡Œä½¿ç”¨å·¥å…·è½‰æ›ï¼Œæäº¤æ¨é€æ™‚ä¸€ç‡æ”¹å›åŸä¾†çš„èªè¨€

ä¸‰çœ‹èµ·ä¾†æ˜¯æœ‰æ”¹å–„äº†ï¼Œä½†æœ‰é»å¤¢å¹»ï¼Œæˆ‘æƒ³ä¸åˆ°ä»€éº¼å²å®³çš„å·¥å…·å¯ä»¥å¿«é€Ÿåˆç²¾æº–çš„æŒçºŒè½‰è­¯å…©ç¨®èªè¨€

èªªåˆ°åº•é‚„æ˜¯å¿ç—›æ”¾æ£„æµ·é—Šå¤©ç©ºï¼Œä¸€å€‹ç¨‹å¼åº«å¤šç¨®æ’°å¯«é¢¨æ ¼å¾ä¾†ä¸æ˜¯å¥½äº‹æƒ… (è§£åˆä½µè¡çªè§£åˆ°èµ·è¡çª)

é‚„æ˜¯ä¸€å€‹åº«ä¸€ç¨®æ’°å¯«é¢¨æ ¼è·¯æ‰èµ°å¾—é•·ä¹… ğŸ˜Œ